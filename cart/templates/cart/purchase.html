{% extends 'base.html' %}
{% block content %}
<div class="p-3">
    <div class="container">
        <div class="row mt-3">
            <div class="col mx-auto mb-3">
                <h2>Purchase Completed</h2>
                <hr />
                <p>Congratulations, purchase completed. Order number is: <b>#{{ template_data.order_id }}</b>
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Feedback Modal -->
<div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="feedbackLabel">Share your thoughts</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="feedbackForm">
          <div class="mb-3">
            <label for="name" class="form-label">Your Name (optional)</label>
            <input type="text" class="form-control" id="name" name="name" placeholder="Leave blank for anonymous">
          </div>
          <div class="mb-3">
            <label for="thoughts" class="form-label">Your Thoughts</label>
            <textarea class="form-control" id="thoughts" name="thoughts" rows="3" required></textarea>
          </div>
          <div class="d-flex justify-content-end">
            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // Show the feedback popup automatically after checkout
    var feedbackModal = new bootstrap.Modal(document.getElementById("feedbackModal"));
    feedbackModal.show();

    document.getElementById("feedbackForm").addEventListener("submit", function(e) {
        e.preventDefault();
        fetch("{% url 'cart.submit_feedback' template_data.order_id %}", {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: new URLSearchParams(new FormData(this))
        }).then(response => response.json())
          .then(data => {
              if (data.status === "success") {
                  alert("Thanks for your feedback!");
                  feedbackModal.hide();
              } else {
                  alert(data.message);
              }
          });
    });
});
</script>
{% endblock content %}